<!DOCTYPE html>
<html>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
<body>

<h1>Cadastro de Alunos</h1>

<br>

<div ng-app="myApp" ng-controller="myCtrl">
  <form>
    RA: <input type="text" maxlength="6" ng-model="ra"><br><br>
    Nome: <input type="text" ng-model="nome"><br><br>
    Curso: <input type="text" ng-model="curso"><br><br>
    CR: <input type="text" ng-model="cr"><br><br>
    CP: <input type="text" ng-model="cp"><br><br>
    <button ng-click="acessa()">ACESSA</button> &nbsp;
    <button ng-click="acessaforum()">ACESSA-FORUM</button> &nbsp;
    <button ng-click="addNoForum()">ADD-FORUM</button> &nbsp;
    <button ng-click="insere()">INSERE</button> &nbsp;
    <button ng-click="atualiza()">ATUALIZA</button> &nbsp;
    <button ng-click="remove()">REMOVE</button> &nbsp;
    <button ng-click="acessaTudo()">Todos os alunos</button>&nbsp;
  </form>

  <br><br>
  Resultado: {{mensagem}}
  
  <br><br>
  <table cellspacing="8">
    <tr> <th>{{hra}}</th>  <th>{{hnome}}</th>  <th>{{hcurso}}</th>  <th>{{hcp}}</th>  <th>{{hcr}}</th> </tr>
    <tr ng-repeat="x in alunos">
      <td>{{ x.ra }}</td>
      <td>{{ x.nome }}</td>
      <td>{{ x.curso }}</td>
      <td>{{x.cp}}</td>
      <td>{{x.cr}}</td>
    </tr>
  </table>

</div>


<script>
var app = angular.module('myApp', []);
app.controller('myCtrl', function($scope, $http) {

  // ACESSA
  $scope.acessaTudo = function() {
     var url = "/alunos";
     url = "/alunos";
     var request = $http({
                 "method": "get",
                 "url": url});
     request.success(function(reply) {
       if(reply.alunos != null) {
          $scope.hra = "RA";
          $scope.hnome = "Aluno";
          $scope.hcurso = "Curso";
          $scope.hcp = "CP";
          $scope.hcr = "CR";
          $scope.mensagem = "";
          $scope.alunos = reply.alunos;
          } else {
              $scope.clear();
              $scope.mensagem = reply.resultado;
}
                 
         }
      );
      request.error(function(reply) {
         alert("Falha na requisicao");
      }
    );
  };

    //GET pra route do forum
    $scope.acessaforum = function() {
	var url = "/posts";
	var request = $http({
	    "method": "get",
	    "url":url});
	request.success(function(reply){
	    console.log(request)
	});
    }

    //POST pra route do forum
    $scope.addNoForum = function() {
	var url = "/posts";
	var request = $http({
	    "method": "post",
	    "data":{
		"info": "Sending data...",
	    },
	    "url":url});
	request.success(function(reply){
	    console.log(request)
	});
    }    
    
    // ACESSA
  $scope.acessa = function() {
     var url = "/alunos";
     if ($scope.ra != undefined) url = "/alunos/" + $scope.ra;
     var request = $http({
                 "method": "get",
                 "url": url});
     request.success(function(reply) {
        if(reply.alunos != null) {
          $scope.hra = "RA";
          $scope.hnome = "Aluno";
          $scope.hcurso = "Curso";
          $scope.hcp = "CP";
          $scope.hcr = "CR";
          $scope.mensagem = "";
          $scope.alunos = reply.alunos;
          } else {
              $scope.clear();
              $scope.mensagem = reply.resultado;
            }
         }
      );
      request.error(function(reply) {
         alert("Falha na requisicao");
      }
    );
  };

  // INSERE
  $scope.insere = function() {
      $scope.clear();
      if ($scope.ra == undefined || $scope.ra.length == 0 ||
          $scope.nome == undefined || $scope.nome.length == 0 ||
          $scope.cp == undefined || $scope.cp.length == 0 ||
          $scope.cr == undefined || $scope.cr.length == 0 ||
          $scope.curso == undefined || $scope.curso.length == 0) {
             $scope.clear();
             $scope.mensagem = "preencha todos os campos acima";
             return;
      }
      var data = {"ra": $scope.ra,
                  "nome": $scope.nome,
                  "cr": $scope.cr,
                  "cp": $scope.cp,
                  "curso": $scope.curso};
      var request = $http({
                 "method": "post",
                 "url": "/alunos",
                 "data": data});
      request.success(function(reply) {
        $scope.mensagem = reply.resultado;
        }
      );
      request.error(function(reply) {
        alert("Falha na requisicao");
      }
    );
  };

  // ATUALIZA
  $scope.atualiza = function() {
     $scope.clear();
     if (($scope.ra == undefined || $scope.ra.length == 0) ||
($scope.nome == undefined || $scope.nome.length == 0) &&
($scope.cr == undefined || $scope.cr.length == 0) &&
($scope.cp == undefined || $scope.cp.length == 0) &&
         ($scope.curso == undefined || $scope.curso.length == 0)) {
             $scope.clear();
             $scope.mensagem = "preencha  RA e pelo menos um campo acima";
             return;
     }
     var data = {"ra": $scope.ra,
"nome": $scope.nome,
"cp": $scope.cp,
"cr": $scope.cr,
                 "curso": $scope.curso};
     var request = $http({
                 "method": "put",
                 "url": "/alunos/" + $scope.ra,
                 "data": data});
     request.success(function(reply) {
         $scope.mensagem = reply.resultado;
         }
      );
      request.error(function(reply) {
        alert("Falha na requisicao");
       }
    );
  };

  // REMOVE
  $scope.remove = function() {
     $scope.clear();
     if ($scope.ra == undefined || $scope.ra.length == 0) {
         $scope.clear();
         $scope.mensagem = "preencha o RA do aluno";
         return;
     }
     var request = $http({
                 "method": "delete",
                 "url": "/alunos/" + $scope.ra});
     request.success(function(reply) {
         $scope.mensagem = reply.resultado;
       }
     );
     request.error(function(reply) {
        alert("Falha na requisicao");
       }
     );
   };

  // CLEAR
  $scope.clear = function() {
    $scope.alunos = [];
    $scope.mensagem = "";
    $scope.hra = $scope.hnome = $scope.hcurso = "";
    }
  }
);
</script> 

</body>
</html>
